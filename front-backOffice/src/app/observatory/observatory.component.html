<ngx-spinner size="medium" type="ball-spin"> </ngx-spinner>
<app-header></app-header>
<div class="container-fluid">
  <div class="row">
    <div class="col-6 col-table">
      <div *ngIf="loadForm" class="observatory-block">
        <form
          [formGroup]="observatoryForm"
          (submit)="submitObservatory(observatoryForm)"
          disabled
        >
          <div class="inner-checkbox form-group">
            <div class="label">Publier:</div>
            <label class="switch">
              <input
                formControlName="is_published"
                type="checkbox"
                class="success form-control"
              />
              <span
                [ngClass]="{
                  'slider-disabled': !this.edit_btn
                }"
                class="slider round"
              ></span>
            </label>
          </div>
          <div class="row form-item">
            <div class="col">
              <label class="label" for="observatory-title"
                >Nom de l'observatoire*</label
              >
              <input
                InputFeedBack
                type="text"
                formControlName="title"
                id="observatory-title"
                class="form-control"
                placeholder="nom du observatory"
              />
              <app-form-error
                controlName="title"
                errorKey="required"
              ></app-form-error>
            </div>
            <div class="col">
              <label class="label" for="observatory-ref">RÉFÉRENCE*</label>
              <input
                InputFeedBack
                type="text"
                formControlName="ref"
                id="observatory-ref"
                class="form-control"
                placeholder="référence"
              />
              <app-form-error
                controlName="ref"
                errorKey="required"
              ></app-form-error>
            </div>
          </div>
          <div class="row form-item">
            <div class="col">
              <label class="label" for="observatory-color">Couleur</label>
              <input
                InputFeedBack
                type="text"
                formControlName="color"
                id="observatory-color"
                class="form-control"
                placeholder="Couleur"
              />
              <app-form-error
                controlName="color"
                errorKey="required"
              ></app-form-error>
            </div>
            <div class="col">
              <label class="label">Photo</label>
              <div *ngIf="observatory.photo">
                <a [href]="'http://localhost:8082/static/data/images/' + observatory.photo" target="_blank">
                  {{ observatory.photo }} <i class="icon-eye"></i>
                </a>
              </div>
              <input style="display: none" accept="image/x-png,image/gif,image/jpeg"
                type="file" (change)=onPhotoChange($event) #photoInput>
              <button type="button" *ngIf="!selectedPhoto" class="blue-btn" (click)="photoInput.click()">
                <i class="icon-download"></i>{{ observatory.photo ? 'Modifier la photo' : 'Ajouter une photo' }}
              </button>
              <div *ngIf="selectedPhoto">
                Photo sélectionnée :<br />
                <button class="btn p-0" type="button" (click)="onPhotoCancel(photoInput)">
                  <i class="icon-cancel-circle text-danger"></i>
                </button> {{ selectedPhoto.name }}
              </div>
            </div>
          </div>
          <div class="row form-item">
            <div class="col">
              <label class="label" for="observatory-geom">WKT</label>
              <textarea
                InputFeedBack
                formControlName="geom"
                id="observatory-geom"
                class="form-control"
                placeholder="WKT"
              ></textarea>
              <app-form-error
                controlName="geom"
                errorKey="required"
              ></app-form-error>
            </div>
          </div>
          <ngb-alert
            class="alert"
            *ngIf="alert"
            [dismissible]="false"
            [type]="alert.type"
            >{{ alert.message }}</ngb-alert
          >
          <div class="submit-btn-group">
            <button
              type="button"
              *ngIf="id_observatory"
              class="btn btn-outline-warning btn-edit"
              [class.active_edit]="edit_btn"
              (click)="editForm()"
            >
              <i class="icon-pen"></i>{{ edit_btn_text }}
            </button>
            <button
              class="btn btn-outline-success btn-submit"
              type="submit"
              [disabled]="!edit_btn"
            >
              {{ submit_btn_text }}
            </button>
            <button
              type="button"
              *ngIf="id_observatory && currentUser.id_droit_max > 5"
              class="btn btn-outline-danger btn-delete"
              (click)="openDeleteModal(content)"
            >
              <i class="icon-trash delete-observatory"></i>Supprimer
              l'observatoire
            </button>
            <button
              class="btn btn-outline-secondary btn-cancel"
              type="button"
              (click)="onCancel()"
            >
              Retour à la liste
            </button>
          </div>
        </form>
      </div>
    </div>
    <div class="col-6 col-map">
      <!-- <div class="map" leaflet leafletDraw [leafletOptions]="options" [(leafletCenter)]="center" [(leafletZoom)]="zoom"
        [leafletDrawOptions]="drawOptions" (leafletDrawReady)="onDrawReady($event)" (leafletMapReady)="onMapReady($event)">
      </div> -->
    </div>
  </div>
</div>

<ng-template #content let-modal>
  <div class="modal-header">
    <h5 class="modal-title"><i class="icon-trash"></i></h5>
  </div>
  <div class="modal-body">
    Êtes-vous sûr de vouloir supprimer cet observatoire ?
    <br />
    Sa suppression sera définitive
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="cancel-btn"
      style="margin-right: 10px"
      (click)="cancelDelete()"
    >
      ANNULER
    </button>
    <button type="button" class="green-btn" (click)="deleteObservatory()">
      OUI
    </button>
  </div>
</ng-template>
